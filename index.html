<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Aã€œZã‚¿ã‚¤ãƒ”ãƒ³ã‚°ç·´ç¿’</title>
  <style>
    body {
      background-color: #eef7f1;
      font-family: 'Segoe UI', 'Hiragino Kaku Gothic ProN', Meiryo, sans-serif;
      text-align: center;
      margin: 20px;
      color: #2e3b30;
    }
    #keyboard-wrapper {
      position: relative;
      display: inline-block;
    }
    #keyboard-image {
      width: 600px;
      height: auto;
      margin-bottom: 20px;
    }
    #key-indicator {
      position: absolute;
      width: 30px;
      height: 30px;
      border-radius: 8px;
      background-color: rgba(255, 0, 0, 0.5);
      pointer-events: none;
      transform: translate(-50%, -50%);
    }
    #target {
      font-size: 4em;
      margin: 40px;
      letter-spacing: 0.5em;
      font-weight: bold;
    }
    #highlight {
      color: #d9534f;
      background-color: #ffecec;
      border-radius: 4px;
      padding: 2px 4px;
    }
    #inputBox {
      font-size: 2em;
      padding: 10px;
      width: 60%;
      letter-spacing: 0.2em;
      background-color: #ffffff;
      border: 2px solid #a3d9b1;
      border-radius: 8px;
      color: #2e3b30;
      margin-top: 20px;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    #results {
      position: static;
      margin-top: 30px;
      max-height: 30vh;
      overflow-y: auto;
      background-color: #ffffffcc;
      border-radius: 10px;
      padding: 10px;
      width: 60%;
      color: #2e3b30;
      text-align: center;
      margin-left: auto;
      margin-right: auto;
    }
    #message {
      position: static;
      font-size: 1.2em;
      margin-top: 10px;
      font-weight: bold;
      color: #2e6e4c;
      margin-bottom: 20px;
    }
    .error {
      background-color: #ffcccc;
    }
    #targetDisplay {
      font-size: clamp(1.2em, 3vw, 2.5em);
      margin: 30px auto;
      letter-spacing: 0.35em;
      font-weight: bold;
      width: 100%;
      max-width: 100%;
      white-space: nowrap;
      overflow: hidden;
      box-sizing: border-box;
      display: flex;
      justify-content: center;
    }
    #restartButton {
      display: none;
      margin: 20px auto;
      padding: 10px 20px;
      font-size: 1.2em;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    #restartButton:hover {
      background-color: #45a049;
    }
    #history {
      position: fixed;
      top: 100px;
      right: 20px;
      width: 280px;
      max-height: 80vh;
      overflow-y: auto;
      background-color: #ffffffcc;
      padding: 15px;
      border-radius: 10px;
      text-align: left;
      font-size: 0.9em;
      color: #2e3b30;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>

<p id="inputNotice" style="color: #b94a48; font-weight: bold; font-size: 1.1em; background: #fff0f0; padding: 10px; border-radius: 8px; display: inline-block; margin-bottom: 20px;">
  â€» åŠè§’è‹±æ•°å…¥åŠ›ã§ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã—ã¦ãã ã•ã„ï¼ˆå…¨è§’ãƒ»ã‹ãªå…¥åŠ›ã¯ç„¡åŠ¹ã§ã™ï¼‰
</p>

<div id="targetDisplay"></div>

<div id="keyboard-wrapper">
  <img id="keyboard-image" src="keyboard-image.png" alt="ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å›³">
  <div id="key-indicator"></div>
</div>

<input id="inputBox" type="text" maxlength="26" autofocus autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">
<div id="results"></div>
<div id="message"></div>
<button id="restartButton">ã‚‚ã†ä¸€åº¦ç·´ç¿’ã™ã‚‹</button>
<audio id="errorSound" src="https://www.soundjay.com/button/beep-07.wav" preload="auto"></audio>

<script>
  const targetString = "abcdefghijklmnopqrstuvwxyz";
  let currentIndex = 0;
  const inputBox = document.getElementById("inputBox");
  const keyIndicator = document.getElementById("key-indicator");
  const results = document.getElementById("results");
  const message = document.getElementById("message");
  const restartButton = document.getElementById("restartButton");
  const errorSound = document.getElementById("errorSound");
  const targetDisplay = document.getElementById("targetDisplay");

  function updateTargetDisplay() {
    if (currentIndex >= targetString.length) {
      targetDisplay.innerHTML = "<span style='color: #2e6e4c;'>å…¨ã¦ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸï¼</span>";
    } else {
      const before = targetString.slice(0, currentIndex);
      const current = targetString[currentIndex];
      const after = targetString.slice(currentIndex + 1);
      targetDisplay.innerHTML =
        [...before].map(c => `<span style=\"opacity: 0.3\">${c}</span>`).join('') +
        `<span id=\"highlight\">${current}</span>` +
        [...after].map(c => `<span style=\"opacity: 0.3\">${c}</span>`).join('');
    }
  }

  const keyPositions = {
    a: { left: 100, top: 205 }, b: { left: 250, top: 240 }, c: { left: 185, top: 240 }, d: { left: 165, top: 205 }, e: { left: 160, top: 170 },
    f: { left: 200, top: 205 }, g: { left: 235, top: 205 }, h: { left: 265, top: 205 }, i: { left: 325, top: 170 }, j: { left: 300, top: 205 },
    k: { left: 330, top: 205 }, l: { left: 365, top: 205 }, m: { left: 315, top: 240 }, n: { left: 285, top: 240 }, o: { left: 355, top: 170 },
    p: { left: 390, top: 170 }, q: { left: 90, top: 170 }, r: { left: 190, top: 170 }, s: { left: 135, top: 205 }, t: { left: 225, top: 170 },
    u: { left: 290, top: 170 }, v: { left: 215, top: 240 }, w: { left: 125, top: 170 }, x: { left: 154, top: 240 }, y: { left: 260, top: 170 },
    z: { left: 118, top: 240 },
  };

  function moveIndicatorForTarget() {
    const targetChar = targetString[currentIndex];
    const pos = keyPositions[targetChar];
    if (pos) {
      keyIndicator.style.left = pos.left + 'px';
      keyIndicator.style.top = pos.top + 'px';
      keyIndicator.style.display = 'block';
    } else {
      keyIndicator.style.display = 'none';
    }
  }

  function resetPractice() {
    currentIndex = 0;
    inputBox.disabled = false;
    results.innerHTML = "";
    message.textContent = "";
    updateTargetDisplay();
    moveIndicatorForTarget();
    restartButton.style.display = "none";
    inputBox.focus();
  }

  inputBox.addEventListener("input", () => {
    const inputChar = inputBox.value.slice(-1).toLowerCase();
    const targetChar = targetString[currentIndex];

    if (inputChar === targetChar) {
      currentIndex++;
      updateTargetDisplay();
      moveIndicatorForTarget();
      if (currentIndex >= targetString.length) {
        message.textContent = "ğŸ‰ å®Œäº†ã—ã¾ã—ãŸï¼";
        inputBox.disabled = true;
        keyIndicator.style.display = 'none';
        restartButton.style.display = "block";
      }
    } else {
      results.innerHTML += `<span class=\"error\">âŒ ${inputChar}</span> `;
      errorSound.play();
    }
    inputBox.value = "";
  });

  restartButton.addEventListener("click", resetPractice);

  updateTargetDisplay();
  moveIndicatorForTarget();
</script>

<div id="history"></div>

</body>
</html>
